
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!--FIXME-->
    <meta http-equiv="Access-Control-Allow-Origin" content="*">

    <link rel="stylesheet" type="text/css" href="http://developer.amap.com/Public/css/demo.Default.css" />
    <script language="javascript" src="http://webapi.amap.com/maps?v=1.3&key=2c3b371c0ef7e568f3d306c8c2c4d74c"></script>
    <title>图腾柱</title>

    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/geo.css"/>
    <link rel="stylesheet" type="text/css" href="css/menu.css"/>
    <link rel="stylesheet" type="text/css" href="css/message.css"/>
</head>
<body>

<p id="positionText">Position is here when got.</p>
<div id="allmap"></div>

<div id="menu">
    <ul class="fixed">
        <li data-id="__self">
            <div class="head"><img art="type.self"/><span class="glyphicon glyphicon-chevron-right"></span></div>
            <div class="detail hide" template="self.detail" data-id="__self">

            </div>
        </li>
    </ul>
    <ul class="items">

    </ul>
</div>
<div id="message" class="hide">
</div>

</body>
</html>



<script src="js/lib/jquery.min.js"></script>
<script src="js/lib/underscore.js"></script>


<script type="text/javascript" src="js/interface.js"></script>
<script type="text/javascript" src="js/art.js"></script>


<script type="text/javascript" src="js/mockData.js"></script>

<script type="text/javascript" src="js/geo.js"></script>
<script type="text/javascript" src="js/mapg.js"></script>
<script type="text/javascript" src="js/markg.js"></script>
<script type="text/javascript" src="js/control.js"></script>
<script type="text/javascript" src="js/message.js"></script>
<script type="text/javascript" src="js/action.js"></script>
<script language="javascript">

function onLocationChange(po){
    window.map.showPosition(po)
    window.self.position=po
    window.marks["type.self"](window.self)
}

function getLocation(){

    window.geo.getPosition(function(po){
        window.map.init(po)
        window.self.position=po
        //window.ma.addEventListener("tilesloaded",function(){
          //  window.marks["type.self"](window.self)
        //})
        onLocationChange(po)
        watchLocation()
        markItems()
        window.map.setCenter(ma,window.self.position)
    },window.message.err)
}
function watchLocation(){
    window.geo.watchPosition(onLocationChange,window.message.err)
}

function markItems(){
    _(window.items).each(function(item){
        window.marks["type."+item.type](item)
    })
}
$(function(){
        getLocation()

})
</script>